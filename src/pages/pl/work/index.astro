---
import Page from '../../../layouts/Page.astro';
import { projects, getCategories } from '../../../lib/projects';

const categories = getCategories();
const hasUrl = (url: string) => url && url !== '#';
---

<Page lang="pl" title="Projekty — New Frame Studio">
  <section class="relative min-h-screen pt-40 md:pt-48 pb-32" style="background-color: var(--color-bg);">
    <div class="px-6 md:px-10 max-w-[1400px] mx-auto">
      <!-- Header -->
      <div class="mb-16 md:mb-24">
        <span class="text-mono-xs text-[var(--color-text-subtle)] block mb-4">WYBRANE PROJEKTY</span>
        <h1 class="text-display-lg text-[var(--color-text)]">
          Projekty
        </h1>
      </div>

      <!-- Filter chips -->
      <div class="flex flex-wrap gap-3 mb-16" id="work-filters">
        {categories.map((cat) => (
          <button
            class="filter-chip text-mono-xs px-5 py-2.5 rounded-full border transition-all duration-300"
            data-filter={cat === 'ALL' ? 'ALL' : cat}
            style={cat === 'ALL'
              ? 'background-color: var(--color-text); color: var(--color-bg); border-color: var(--color-text);'
              : 'background-color: transparent; color: var(--color-text); border-color: var(--color-border-strong);'}
          >
            {cat === 'ALL' ? 'WSZYSTKO' : cat}
          </button>
        ))}
      </div>

      <!-- Project grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8" id="work-grid">
        {projects.map((project, i) => (
          <a
            href={hasUrl(project.url) ? project.url : undefined}
            target={hasUrl(project.url) ? '_blank' : undefined}
            rel={hasUrl(project.url) ? 'noopener' : undefined}
            class="work-card group block relative overflow-hidden rounded-xl"
            data-category={project.category}
            style={i === 0 ? 'grid-column: 1 / -1;' : ''}
          >
            <div class={`relative overflow-hidden ${i === 0 ? 'aspect-[16/8]' : 'aspect-[4/3]'}`}>
              <img
                src={project.image}
                alt={project.name}
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                loading={i < 2 ? 'eager' : 'lazy'}
              />
              <div class="absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors duration-500"></div>
              <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                <span class="text-mono-xs text-white bg-white/10 backdrop-blur-sm px-5 py-2.5 rounded-full border border-white/20">
                  ODWIEDŹ STRONĘ
                </span>
              </div>
            </div>

            <div class="flex justify-between items-end mt-4 pb-2">
              <h2 class="text-lg font-semibold text-[var(--color-text)]" style="font-family: var(--font-display);">
                {project.name}
              </h2>
              <span class="text-mono-xs text-[var(--color-text-muted)]">{project.category}</span>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>
</Page>

<script>
  import gsap from 'gsap';

  function initWorkPage() {
    const filters = document.querySelectorAll('.filter-chip');
    const cards = document.querySelectorAll('.work-card');

    gsap.fromTo(cards,
      { y: 40, opacity: 0 },
      { y: 0, opacity: 1, duration: 0.6, stagger: 0.1, ease: 'power3.out', delay: 0.2 }
    );

    filters.forEach((btn) => {
      btn.addEventListener('click', () => {
        const filter = (btn as HTMLElement).dataset.filter;

        filters.forEach((f) => {
          const el = f as HTMLElement;
          if (el.dataset.filter === filter) {
            el.style.backgroundColor = 'var(--color-text)';
            el.style.color = 'var(--color-bg)';
            el.style.borderColor = 'var(--color-text)';
          } else {
            el.style.backgroundColor = 'transparent';
            el.style.color = 'var(--color-text)';
            el.style.borderColor = 'var(--color-border-strong)';
          }
        });

        cards.forEach((card) => {
          const el = card as HTMLElement;
          const category = el.dataset.category;

          if (filter === 'ALL' || category === filter) {
            gsap.to(el, { opacity: 1, scale: 1, duration: 0.4, ease: 'power2.out', display: 'block' });
          } else {
            gsap.to(el, { opacity: 0, scale: 0.95, duration: 0.3, ease: 'power2.in', onComplete: () => { el.style.display = 'none'; } });
          }
        });
      });
    });
  }

  initWorkPage();
  document.addEventListener('astro:after-swap', initWorkPage);
</script>
