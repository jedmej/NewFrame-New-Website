---
import type { Lang } from '../../i18n/translations';
import { useTranslations } from '../../i18n/translations';

interface Props {
  lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);
const year = new Date().getFullYear();
const email = 'jed.mejzner@gmail.com';

const marqueeText = 'NEW FRAME  ✦  DESIGN  ✦  DEVELOPMENT  ✦  BRANDING  ✦  STRATEGY  ✦  ';
---

<footer class="relative z-50" style="color: #ffffff;">

  <!-- ===== 0. Bouncy SVG Top Edge ===== -->
  <div class="footer-bounce-wrap" style="position: relative; margin-bottom: -1px;">
    <svg id="footer-bounce-svg" viewBox="0 0 2278 683" preserveAspectRatio="none" style="display: block; width: 100%; height: 250px;">
      <path id="bouncy-path" d="M0-0.3C0-0.3,464,350,1139,350S2278-0.3,2278-0.3V683H0V-0.3z" fill="#DA382E" />
    </svg>
  </div>

  <!-- ===== 1. Giant CTA Block ===== -->
  <div style="background-color: #DA382E;">
  <div class="px-6 md:px-10 pt-32 md:pt-48 pb-16 md:pb-24">
    <div class="max-w-[1400px] mx-auto">
      <!-- Availability badge -->
      <div class="flex items-center gap-2.5 mb-8 md:mb-12">
        <span class="w-2 h-2 rounded-full bg-white animate-pulse"></span>
        <span class="text-mono-xs text-white/70">{t.footer.available}</span>
      </div>

      <!-- Giant CTA text -->
      <h2
        id="footer-cta"
        class="text-display-lg text-white uppercase"
        style="line-height: 0.95;"
      >
        {t.footer.cta}
      </h2>

      <!-- Email link -->
      <a
        href={`mailto:${email}?subject=Project%20Inquiry%20-%20New%20Frame%20Studio`}
        class="group inline-block mt-8 md:mt-12"
        data-cursor="CLICK"
      >
        <span
          class="block text-white/70 group-hover:text-white transition-colors duration-500"
          style="font-family: var(--font-serif); font-size: clamp(1.4rem, 3.5vw, 3rem); font-style: italic; letter-spacing: -0.02em;"
        >
          {email}
        </span>
        <span class="block w-0 group-hover:w-full h-px bg-white transition-all duration-700 ease-out mt-2"></span>
      </a>
    </div>
  </div>

  <!-- ===== 2. Decorative Marquee Divider ===== -->
  <div class="relative overflow-hidden py-6 border-t border-b border-white/15">
    <div class="footer-marquee whitespace-nowrap">
      <span class="text-mono-xs text-white/20 inline-block">{marqueeText}{marqueeText}{marqueeText}{marqueeText}{marqueeText}{marqueeText}{marqueeText}{marqueeText}</span>
    </div>
  </div>

  <!-- ===== 3. Link Grid ===== -->
  <div class="px-6 md:px-10 py-16 md:py-20">
    <div class="max-w-[1400px] mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-12 md:gap-8">
        <!-- Column 1: Navigation -->
        <div>
          <span class="text-mono-xs text-white/40 block pb-4 mb-6 border-b border-white/15">
            {t.footer.navigation}
          </span>
          <ul class="space-y-3">
            <li>
              <a href={`/${lang}/`} class="footer-link text-sm text-white/70 hover:text-white transition-all duration-300 inline-flex items-center gap-2 group">
                <span class="w-0 group-hover:w-3 h-px bg-white transition-all duration-300"></span>
                <span class="scramble-target">Home</span>
              </a>
            </li>
            <li>
              <a href={`/${lang}/work`} class="footer-link text-sm text-white/70 hover:text-white transition-all duration-300 inline-flex items-center gap-2 group">
                <span class="w-0 group-hover:w-3 h-px bg-white transition-all duration-300"></span>
                <span class="scramble-target">{t.nav.work}</span>
              </a>
            </li>
            <li>
              <a href={`/${lang}/#about`} class="footer-link text-sm text-white/70 hover:text-white transition-all duration-300 inline-flex items-center gap-2 group">
                <span class="w-0 group-hover:w-3 h-px bg-white transition-all duration-300"></span>
                <span class="scramble-target">{t.nav.about || 'About'}</span>
              </a>
            </li>
            <li>
              <a href={`/${lang}/#contact`} class="footer-link text-sm text-white/70 hover:text-white transition-all duration-300 inline-flex items-center gap-2 group">
                <span class="w-0 group-hover:w-3 h-px bg-white transition-all duration-300"></span>
                <span class="scramble-target">{t.nav.contact}</span>
              </a>
            </li>
          </ul>
        </div>

        <!-- Column 2: Social -->
        <div>
          <span class="text-mono-xs text-white/40 block pb-4 mb-6 border-b border-white/15">
            {t.footer.social}
          </span>
          <ul class="space-y-3">
            {['Instagram', 'LinkedIn', 'Behance', 'Awwwards'].map((social) => (
              <li>
                <a href="#" class="footer-link text-sm text-white/70 hover:text-white transition-all duration-300 inline-flex items-center gap-2 group" target="_blank" rel="noopener">
                  <span class="w-0 group-hover:w-3 h-px bg-white transition-all duration-300"></span>
                  <span class="scramble-target">{social}</span>
                  <svg class="w-3 h-3 opacity-0 group-hover:opacity-40 transition-opacity duration-300 -translate-y-px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 17L17 7M17 7H7M17 7v10" /></svg>
                </a>
              </li>
            ))}
          </ul>
        </div>

        <!-- Column 3: Info -->
        <div>
          <span class="text-mono-xs text-white/40 block pb-4 mb-6 border-b border-white/15">
            {t.footer.info}
          </span>
          <ul class="space-y-3">
            <li class="text-sm text-white/70">Remote Worldwide</li>
            <li>
              <a href={`mailto:${email}`} class="text-sm text-white/70 hover:text-white transition-colors duration-300">
                {email}
              </a>
            </li>
          </ul>
          <div class="mt-8 pt-4 border-t border-white/15">
            <p class="text-sm text-white/60">&copy; {year} New Frame Studio</p>
            <p class="text-sm text-white/40 mt-1">{t.footer.rights}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== 4. Bottom Bar ===== -->
  <div class="px-6 md:px-10 py-6 border-t border-white/15">
    <div class="max-w-[1400px] mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
      <!-- Logo -->
      <div class="flex items-center gap-2.5 text-white/40">
        <svg class="w-4 h-4" viewBox="0 0 500 500" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="300" height="100" transform="matrix(-1 0 0 1 400 400)" fill="currentColor"/>
          <rect width="100" height="400" transform="matrix(-1 0 0 1 500 100)" fill="currentColor"/>
          <rect width="300" height="100" transform="matrix(1 0 0 -1 100 100)" fill="currentColor"/>
          <rect width="100" height="400" transform="matrix(1 0 0 -1 0 400)" fill="currentColor"/>
        </svg>
        <span class="text-mono-xs">NEW FRAME</span>
      </div>

      <!-- Back to top -->
      <button
        id="back-to-top"
        class="group text-mono-xs text-white/40 hover:text-white/70 transition-colors duration-300 flex items-center gap-2"
      >
        <span>{t.footer.backToTop}</span>
        <svg class="w-3.5 h-3.5 transition-transform duration-500 group-hover:-translate-y-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
      </button>
    </div>
  </div>

  </div><!-- close background wrapper -->
</footer>

<style>
  .footer-marquee {
    display: flex;
    animation: footer-scroll 60s linear infinite;
  }

  @keyframes footer-scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  .footer-marquee:hover {
    animation-play-state: paused;
  }
</style>

<script>
  import gsap from 'gsap';
  import { SplitText } from 'gsap/SplitText';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  import { MorphSVGPlugin } from 'gsap/MorphSVGPlugin';
  import { ScrambleTextPlugin } from 'gsap/ScrambleTextPlugin';

  gsap.registerPlugin(SplitText, ScrollTrigger, MorphSVGPlugin, ScrambleTextPlugin);

  function initFooter() {
    // Back to top — use Lenis if available
    const btn = document.getElementById('back-to-top');
    btn?.addEventListener('click', () => {
      const lenis = (window as any).lenis;
      if (lenis) {
        lenis.scrollTo(0);
      } else {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    });

    // Bouncy SVG top edge based on scroll velocity
    const bouncyPath = document.getElementById('bouncy-path');
    if (bouncyPath) {
      const down = 'M0-0.3C0-0.3,464,350,1139,350S2278-0.3,2278-0.3V683H0V-0.3z';
      const flat = 'M0-0.3C0-0.3,464,0,1139,0s1139-0.3,1139-0.3V683H0V-0.3z';

      ScrollTrigger.create({
        trigger: '.footer-bounce-wrap',
        start: 'top bottom',
        onEnter: (self) => {
          const velocity = self.getVelocity();
          const variation = Math.min(Math.abs(velocity) / 5000, 1.5);
          gsap.fromTo(bouncyPath,
            { morphSVG: down },
            {
              duration: 2.5,
              morphSVG: flat,
              ease: `elastic.out(${1.2 + variation}, ${Math.max(0.2, 0.8 - variation * 0.5)})`,
              overwrite: true,
            }
          );
        },
      });
    }

    // SplitText character animation on giant CTA
    const ctaEl = document.getElementById('footer-cta');
    if (ctaEl && !ctaEl.dataset.animated) {
      ctaEl.dataset.animated = 'true';

      const split = new SplitText(ctaEl, {
        type: 'chars',
        charsClass: 'split-char',
      });

      gsap.fromTo(split.chars,
        { y: 60, opacity: 0, rotateX: -40 },
        {
          y: 0,
          opacity: 1,
          rotateX: 0,
          duration: 0.8,
          stagger: 0.02,
          ease: 'power4.out',
          scrollTrigger: {
            trigger: ctaEl,
            start: 'top 85%',
            once: true,
          },
        }
      );
    }

    // Scramble text on hover for footer links
    document.querySelectorAll('.footer-link').forEach((link) => {
      const target = link.querySelector('.scramble-target');
      if (!target) return;
      const original = target.textContent || '';
      link.addEventListener('mouseenter', () => {
        gsap.to(target, {
          duration: 0.5,
          scrambleText: { text: original, chars: 'abcdefghijklmnopqrstuvwxyz', speed: 0.4 },
        });
      });
    });
  }

  initFooter();
  document.addEventListener('astro:after-swap', initFooter);
</script>
